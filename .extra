# =============================================================================
# Environment Configuration
# =============================================================================

# Locale
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8

# PATH additions
export PATH="$HOME/.local/bin:$PATH"
export PATH="/Users/jlaws/.antigravity/antigravity/bin:$PATH"
export PATH="/usr/local/sbin:/Applications/Visual Studio Code.app/Contents/Resources/app/bin:$PATH"
export PATH="${HOMEBREW_PREFIX}/opt/openssl/bin:$PATH"

# AWS
export AWS_SDK_LOAD_CONFIG=true

# History
export HISTFILESIZE=10000
export HISTSIZE=${HISTFILESIZE}
export HSTR_CONFIG=hicolor

# =============================================================================
# Tool Initialization
# =============================================================================

# Autojump
[ -f /opt/homebrew/etc/profile.d/autojump.sh ] && . /opt/homebrew/etc/profile.d/autojump.sh
[ -f /usr/local/etc/profile.d/autojump.sh ] && . /usr/local/etc/profile.d/autojump.sh

# ====
# Claude
# ====

alias dclaude="docker sandbox run claude ./"

# =============================================================================
# Git Configuration
# =============================================================================

GIT_AUTHOR_NAME="Joe Laws"
GIT_COMMITTER_NAME="$GIT_AUTHOR_NAME"
git config --global user.name "$GIT_AUTHOR_NAME"
GIT_AUTHOR_EMAIL="1224112+jlaws@users.noreply.github.com"
GIT_COMMITTER_EMAIL="$GIT_AUTHOR_EMAIL"
git config --global user.email "$GIT_AUTHOR_EMAIL"

# =============================================================================
# ls & Color Configuration
# =============================================================================

# Detect which `ls` flavor is in use
if ls --color > /dev/null 2>&1; then
	# GNU `ls`
	colorflag="--color"
	export LS_COLORS='no=00:fi=00:di=01;31:ln=01;36:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arj=01;31:*.taz=01;31:*.lzh=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.gz=01;31:*.bz2=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.avi=01;35:*.fli=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.ogg=01;35:*.mp3=01;35:*.wav=01;35:'
else
	# macOS `ls`
	colorflag="-G"
	export LSCOLORS='BxBxhxDxfxhxhxhxhxcxcx'
fi

alias ls="command ls ${colorflag}"
alias l="ls -lF ${colorflag}"
alias la="ls -lAF ${colorflag}"
alias lsd="ls -lF ${colorflag} | grep --color=never '^d'"

# Colored grep
alias grep='grep --color=auto'
alias fgrep='fgrep --color=auto'
alias egrep='egrep --color=auto'

# =============================================================================
# Navigation Aliases
# =============================================================================

alias ..="cd .."
alias ...="cd ../.."
alias ....="cd ../../.."
alias .....="cd ../../../.."
alias ~="cd ~"
alias -- -="cd -"

# Directory shortcuts
alias dl="cd ~/Downloads"
alias dt="cd ~/Desktop"
alias p="cd ~/Workspace"

# =============================================================================
# Git Aliases
# =============================================================================

alias g="git"
alias ga='git commit --amend --no-edit'
alias gm='git checkout main'
alias gcf='git checkout --'
alias gr='git checkout main && git pull && git branch --merged | grep -v "\*\|main\|master" | xargs -n 1 git branch -d'
alias gs='git checkout main && git pull && git checkout joe && git rebase main'
alias grmb='git branch | grep -v "main\|master" | xargs git branch -D'
alias gitclean='git clean -ffxd'

# =============================================================================
# Cleanup & Maintenance
# =============================================================================

# Xcode
alias rmdd='rm -rf $HOME/Library/Developer/Xcode/DerivedData'
alias rma='rmdd && killall -9 watchman'

# CocoaPods
alias rmp='rm -rf ~/Library/Caches/CocoaPods && rm -rf Pods && pod deintegrate && rm Podfile.lock'

# System cleanup
alias cleanup="find . -type f -name '*.DS_Store' -ls -delete"
alias dorig='find . -name \*.orig -delete'
alias emptytrash="sudo rm -rfv /Volumes/*/.Trashes; sudo rm -rfv ~/.Trash; sudo rm -rfv /private/var/log/asl/*.asl; sqlite3 ~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV* 'delete from LSQuarantineEvent'"
alias lscleanup="/System/Library/Frameworks/CoreServices.framework/Frameworks/LaunchServices.framework/Support/lsregister -kill -r -domain local -domain system -domain user && killall Finder"

# System updates
alias update='sudo softwareupdate -i -a; brew update; brew upgrade; brew cleanup; npm install npm -g; npm update -g; sudo gem update --system; sudo gem update; sudo gem cleanup'

# =============================================================================
# Network
# =============================================================================

alias ip="dig +short myip.opendns.com @resolver1.opendns.com"
alias localip="ipconfig getifaddr en0"
alias ips="ifconfig -a | grep -o 'inet6\? \(addr:\)\?\s\?\(\(\([0-9]\+\.\)\{3\}[0-9]\+\)\|[a-fA-F0-9:]\+\)' | awk '{ sub(/inet6? (addr:)? ?/, \"\"); print }'"
alias ifactive="ifconfig | pcregrep -M -o '^[^\t:]+:([^\n]|\n\t)*status: active'"
alias flush="dscacheutil -flushcache && killall -HUP mDNSResponder"

# HTTP methods (requires libwww-perl)
alias GET="lwp-request -m 'GET'"
alias HEAD="lwp-request -m 'HEAD'"
alias POST="lwp-request -m 'POST'"
alias PUT="lwp-request -m 'PUT'"
alias DELETE="lwp-request -m 'DELETE'"
alias TRACE="lwp-request -m 'TRACE'"
alias OPTIONS="lwp-request -m 'OPTIONS'"

# =============================================================================
# macOS System
# =============================================================================

# Finder
alias show="defaults write com.apple.finder AppleShowAllFiles -bool true && killall Finder"
alias hide="defaults write com.apple.finder AppleShowAllFiles -bool false && killall Finder"
alias hidedesktop="defaults write com.apple.finder CreateDesktop -bool false && killall Finder"
alias showdesktop="defaults write com.apple.finder CreateDesktop -bool true && killall Finder"

# Spotlight
alias spotoff="sudo mdutil -a -i off"
alias spoton="sudo mdutil -a -i on"

# Volume
alias stfu="osascript -e 'set volume output muted true'"
alias pumpitup="osascript -e 'set volume output volume 100'"

# Screen lock
alias afk="/System/Library/CoreServices/Menu\ Extras/User.menu/Contents/Resources/CGSession -suspend"

# System tools
alias plistbuddy="/usr/libexec/PlistBuddy"
alias airport='/System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport'

# =============================================================================
# Applications
# =============================================================================

alias chrome='/Applications/Google\ Chrome.app/Contents/MacOS/Google\ Chrome'
alias chromekill="ps ux | grep '[C]hrome Helper --type=renderer' | grep -v extension-process | tr -s ' ' | cut -d ' ' -f2 | xargs kill"

# =============================================================================
# Development Tools
# =============================================================================

# Linting and formatting (Swift)
alias fm='make lint-auto'
alias fr='swift-format -r -i -m format Sources Tests Package.swift && swiftlint autocorrect'
alias fp='swift-format -r -i -m format Sources Tests Package.swift Stats .build && swiftlint autocorrect'

# =============================================================================
# Utility Aliases
# =============================================================================

# Enable aliases to be sudo'ed
alias sudo='sudo '

# Shell
alias reload="exec ${SHELL} -l"
alias path='echo ${PATH//:/\\n}'
alias hh=hstr

# Date/time
alias week='date +%V'

# Clipboard
alias c="tr -d '\n' | pbcopy"

# Process monitoring
alias t='top -o cpu'

# PDF merge (requires ghostscript)
alias mergepdf='gs -q -dNOPAUSE -dBATCH -sDEVICE=pdfwrite -sOutputFile=_merged.pdf'

# URL encoding
alias urlencode='python3 -c "import sys, urllib.parse; print(urllib.parse.quote_plus(sys.argv[1]));"'

# Map function for piping
alias map="xargs -n1"

# Command fallbacks for macOS
command -v hd > /dev/null || alias hd="hexdump -C"
command -v md5sum > /dev/null || alias md5sum="md5"
command -v sha1sum > /dev/null || alias sha1sum="shasum"

# =============================================================================
# Functions
# =============================================================================

# Search and replace using ripgrep
function rgr {
	rg -0 -l "$1" | AGR_FROM="$1" AGR_TO="$2" xargs -0 perl -pi -e 's/$ENV{AGR_FROM}/$ENV{AGR_TO}/g'
}

# Search and replace using ag (silver searcher)
function agr {
	ag -0 -l "$1" | AGR_FROM="$1" AGR_TO="$2" xargs -0 perl -pi -e 's/$ENV{AGR_FROM}/$ENV{AGR_TO}/g'
}
